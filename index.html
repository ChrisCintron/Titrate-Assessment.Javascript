<!DOCTYPE html>


<html>
<head>
    <title>Titrate Assessment</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="stylesheet.css" type="text/css">
</head>
<body>

    <div id="console1">
        <img src="images/ipad_Gideon.gif" class="myipad" alt="ipad">
        <div id="score1" class="score" >&bull;</div>

    </div>
    <div id="console2">
        <img src="images/book_Gideon.gif" class="mybook" alt="book">
        <div id="score2" class="score" >&bull;</div>
    </div>

<!-- TABLE FOR EASY VIEW AND EXPORT.
Inprogress

    <table id="datatable">
        <thead>
            <tr>
                <th>Child_ID</th>
                <th>SESSION</th>
                <th>TRIAL</th>
                <th>FR_VALUE</th>
                <th>POSITION_IPAD</th>
                <th>RESPONSES_IPAD</th>
                <th>TIME_STAMP</th>
                <th>TIME_TRIAL</th>
                <th>TIME_SESSION</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1</td>
                <td>1</td>
                <td>1</td>
                <td>1</td>
                <td>1</td>
                <td>1</td>
                <td>1</td>
                <td>1</td>
                <td>1</td>
            </tr>
            <tr>
                <td>2</td>
                <td>2</td>
                <td>2</td>
                <td>2</td>
                <td>2</td>
                <td>2</td>
                <td>2</td>
                <td>2</td>
                <td>2</td>
            </tr>
        </tbody>
    </table>
-->
</body>
<script>
$(document).ready(function(){




//---------------Titrate Assessment-----------//
//-----------------Main--------------------//

    var app = {
            //Holds sequence objects
            myevents: [],
            //add sequences to myevent list
            //EX: add_events(sequence1, sequence2, sequence3)
            add_events: function(...events) {
                for (let sequence of events) {
                    app.myevents.push(sequence);
                }
            },
            //Loops through sequence list, on each, executes run()
            run: function() {
                if (app.myevents.length==0){
                    console.log("No sequences to run");
                };
                var i;
                    for (i=0; i<app.myevents.length; ++i) {
                            app.myevents[i].run();
                    }
            },
    };

//------------Main End-------------------//





//------------- App Data -------------//
    var mydata = {
        //------initial data--//
        //Complete
        fr_value: null,
        blackout_time: null,
        switch_sides: null, //normal or reverse
        first_time: null,
        //InProgress

        //Timers//
        t1:0, //Start time
        t2:0, //End time
        score:0,

        history: [], //Container for responses

        response: {
            child_id: null, //Only once
            session: null, //What day are they on. //Only once
            trial: null, //FC, BOTH, first_time, [1,2,3,4]
            fr_value: null,
            position_ipad: null,
            responses_ipad: null,
            time_stamp: null, //stamp each action, append to a list [#,#,#,#]
            time_trial: null, //how long was each trial/sequence
            time_session: null, //how long did the session last
        },



        initialize: function(){
                var data = JSON.parse(localStorage.getItem('Entry_Data'));
                mydata.fr_value = data['key1'];
                mydata.blackout_time = data['key2'];
                mydata.switch_sides = data['key3'];
                mydata.first_time = data['key4'];
                },

        //takes in response dictionary and puts in history list
        store_response_history: function(data) {
            mydata.history.push(data);
            },




    };

//------------- App Data End -------------//




// ---------My Sequences-------------//
//Add a sequence  here and
// then add the sequence to app.add_events(*add new sequence*)
//Remember: Eerything starts off hidden
    var sequence1 = {
        run: function() {
                console.log("Sequence1: Starting");




                console.log("Sequence1: Completed");
                },
        };





                //trial_ipad: function(){

                //};

                /*
                    //---------ipad alone ----------//
                    $('#console1').show();
                    $('#console1').click(function() {
                        controller.score_take();
                        controller.update_console1_score();
                        if (controller.score_checker() == false) {
                            $('#console1').fadeOut(1000);
                        };
                    });
                },
                    */

                //trial_book: function(){
                //},


                    /*
                    //-----------book alone---------//
                    $('#console2').show();
                    $('#console2').click(function() {

                        controller.score_take();
                        controller.update_console1_score();
                        if (controller.score_checker() == false) {
                            $('#console1').fadeOut(1000);
                        };
                    });
                },
                */



    var sequence2 = {
        run: function() {
                console.log("Sequence2: Starting");

                console.log("Sequence2: Completed");
                },
        };

    var sequence3 = {
        run: function() {
                console.log("Sequence3: Starting");

                console.log("Sequence3: Completed");

                },
        };

    var sequence4 = {
        run: function() {
                console.log("Sequence4: Starting");

                console.log("Sequence4: Completed");
                },
        };
//-----------------End----------------//






//--------------Controller-------------//
        //Controls gui events//

var controller = {

    clearscreen: function(){ //Blanks out the screen by jquery hide
        $('#console1').hide()
        $('#console2').hide()

    },

    update_console1_score: function(){ //Syncs gui score with score data
        var str = Array(Number(mydata.score)+ 1).join("&bull;"); //concatenates the large dots into Array
        $('#score1').html(str); //writes in the new html

    },

    timer_start: function(){ //sets t1 to start time
        mydata.t1 = performance.now();
    },

    timer_end: function(){ //sets t2 to end time
        mydata.t2 = performance.now();
    },

    time_reset: function(){
    mydata.t1 = 0;
    mydata.t2 = 0;
    },

    spacebar_next: function(){ //Nexts the current interval.

    },

    score_take: function(){ //take away 1 from score
        mydata.score -= 1;
    },

    score_checker: function(){ //Boolean
        if (mydata.score > 0) {
            return true;
        } else {
            return false;
        };
    },

    switch_sides: function() {
            if (mydata.response.position_ipad == 'left') {
                $('#console1').css("float", "right");
                $('#console2').css("float", "left");
            } else {
                $('#console1').css("float", "left");
                $('#console2').css("float", "right");
            }
    },
};


//---------STARTUP COMMAND BOX-------//
controller.clearscreen();
mydata.score = 5;
controller.update_console1_score();
app.add_events(sequence1)
app.run();

//------------------------------------//










/*

    var general_helper =
    {
        what_sequence: 0, //Keeps track of sequence information
        Trial_number: 0,


        bundle_1_start: function(){
            console1.initialize();
            console1.update_gui_score();
            console_helper.show_everything();
        },

        reset_to_base: function() {
            general_helper.bundle_1_start();
            general_helper.side_switcher();
        },

        normal_side_puter: function() {
            $('#console1').css("float", "left");
            $('#console2').css("float", "right");
        },

        side_switcher: function() {
            var side = $('#console1').css("float");
            console.log('Side= ' + side);

            if (side == 'left') {
                $('#console1').css("float", "right");
                $('#console2').css("float", "left");
                console.log("I switched sides");

            } else if (side == 'right') {
                general_helper.normal_side_puter();
            } else {
                    console.log("Side switcher broke");
            };
        },
        reset: function() {
            console1.initialize();
            console_helper.show_everything();
        },
    };

    var console1 = {
        score: 0,
        initialize: function(){ //resets console1's score
                    console1.score = fr_ratio;

        },
        touch: function(){ //takes away a point from score
            console1.score -= 1;

        },
        update_gui_score: function(){ //Uses console1's score to update_gui_score visuals
                var str = Array(Number(console1.score)+ 1).join("&bull;"); //concatenates the large dots into Array
                $('#score1').html(str); //writes in the new html


        },

        score_one: function(){
                    console1.score = 1;
                    var str = Array(2).join("&bull;"); //Gives score one dot
                    $('#score1').html(str); //writes in the new html
        },
    };

    var console_helper = {
        console1_shower: function(){
                $('#console1').fadeIn();
                $('#score1').fadeIn();
        },
        hide_everything: function() {
                    $('#console1').fadeOut();
                    $('#score1').fadeOut();
                    $('#console2').fadeOut();
                    $('#score1').fadeOut();
                    },
        show_everything: function(){
            $('#console1').fadeIn();
            $('#score1').fadeIn();
            $('#console2').fadeIn();
            $('#score2').fadeIn();
        },
        checker: function(){
                if (console1.score < 1) {
                    console_helper.hide_everything();
                    timer.wait(general_helper.side_switcher);
                    timer.wait(console1.initialize);
                    timer.wait(console1.update_gui_score);
                    timer.wait(console_helper.show_everything);
                    general_helper.Trial_number += 1;

                } else {
                    console.log('Console1 is at: ' + console1.score);
                };

        },
        check_score: function(){
                console.log("Score is: "+ console1.score);
                if (console1.score < 1) {
                    console_helper.hide_everything();
                    timer.wait(console_helper.show_everything);
                    console1.score_one();
                    console1.update_gui_score();
                    setTimeout(general_helper.side_switcher, 1000);

                } else {
                };
        },
    };

    var timer = {
        //tracker: 0,
        records: [], //tracks individual session records
        start: function(){ performance.now();},
        stop: function(){performance.now();},
        log: function(){
            timer.records[timer.tracker] = (timer.stop-timer.start)*1000;
            timer.tracker += 1;
                        },
        wait: function(func){
            setTimeout(func, blackout_time*1000);

        },


    };

    //Sequence #1
    var sequence1 = function() {
        general_helper.what_sequence = 1;
        //var blackout_time = blackout;
        //hide both consoles
        $('#console1').fadeOut();
        $('#console2').fadeOut();

        if (switch_sides == '1') {
            $('#console1').fadeIn();

            $('#console1').click(function() {
                $('#score1').fadeOut();

                setTimeout(function(){ $('#console1').fadeOut(); }, 500);
                setTimeout(function(){ $('#console2').fadeIn(); }, blackout_time * 1000);

                $('#console2').click(function() {
                    $('#score2').hide();
                    setTimeout(function(){ $('#console2').fadeOut(); }, 500);
                    setTimeout(function(){ $('#console1').fadeIn(); }, blackout_time * 1000);
                    setTimeout(function(){ $('#console2').fadeIn(); }, blackout_time * 1000);
                    $('#score1').show();
                    $('#score2').show();
                });
            });
        }   else if (switch_sides == '2') {
            $('#console2').fadeIn();
            $('#console2').click(function() {
                setTimeout(function(){ $('#console2').fadeOut(); }, 500);
                setTimeout(function(){ $('#console1').fadeIn(); }, blackout_time * 1000);

                $('#console1').click(function() {
                    setTimeout(function(){ $('#console1').fadeOut(); }, 500);
                    setTimeout(function(){ $('#console2').fadeIn(); }, blackout_time * 1000);
                    setTimeout(function(){ $('#console1').fadeIn(); }, blackout_time * 1000);
                });
            });
        } else {
            console.log("Error in Sequence1");
        };
    };


    //Sequence #2
    function sequence2(){
        //Used to test which item kids would prefer at FR 1
        console1.score_one(); //set the score == 1
        console.log(switch_sides);
        if (switch_sides == "2") {
            console.log("Worked");
            general_helper.side_switcher();
        };

        $('#console1').click(function(){
            console1.touch(); //subtracks 1 from score
            console1.update_gui_score(); //updates the gui based off of current score
            console_helper.check_score();

        });
        $('#console2').click(function(){
            $('#score2').fadeOut();
            setTimeout(console_helper.hide_everything, 500);
            timer.wait(console_helper.show_everything);
            setTimeout(general_helper.side_switcher, 1000);

        });
    };

    // __SEQUENCE 3___ //
    var seq3_events = {
        //general_helper.what_sequence: 3,
        number_of_trials: 2, //(1) low effort and another high effort
        number_of_trials_completed: 1,
        checker: function(){

            if ((seq3_events.number_of_trials_completed >= seq3_events.number_of_trials) && (console1.score < 1)) {
                console_helper.hide_everything();

                timer.wait(general_helper.bundle_1_start);
                timer.wait(general_helper.normal_side_puter);
                console.log("1");
            } else if (console1.score < 1) {
                    console.log("notc= " + seq3_events.number_of_trials_completed);
                    seq3_events.number_of_trials_completed += 1;
                    console_helper.hide_everything();
                    timer.wait(console_helper.console1_shower);
                    console1.score = 20; // ---------------- Hook entry box onto this
                    setTimeout(console1.update_gui_score, 1000);
                    console.log('2');
            } else{
                console.log("almost");
            };
        },
    };
    //Sequence #3 This only happens on first day
    function sequence3(){
        //init//
            console_helper.hide_everything();
            $('#console1').fadeIn();
            console1.score_one();
            $("#score1").fadeIn();
        ////
            $('#console1').click(function(){
                console1.touch();
                console1.update_gui_score();
                seq3_events.checker();
            });
    };

    //Sequence #4
    var sequence4 = {
        x:4,
        init: function() {
            if (switch_sides == '2') {
                general_helper.side_switcher();
            } else {

            };
            console1.initialize();
            console1.update_gui_score();
        },
        seq: function() {
        $('#console1').click(function(){
            console1.touch(); //subtracks 1 from score
            console1.update_gui_score(); //updates the gui based off of current score
            console_helper.checker(); //
            });
            $('#console2').click(function(){
                $('#score2').fadeOut();
                setTimeout(console_helper.hide_everything, 700);
                timer.wait(general_helper.reset_to_base);
            });
        },
    };

    //Show Gideon in this order
    //switch_sides = '2';
    //S1 Works
    //S2 broken
    //S3 N?A
    //S4 Works


    //__Sequence_1__
    //Needs to stop after 2 intervals
    //Switch sides is broken
    //Revise this section. You can do it way more effeciently..
    //sequence1();

    //__Sequence_2___
    //Needs to stop after 1 interval
    //Make sure timing methods are correct. Ipad seems to last a bit longer
    //sequence2();

    //__Sequence_3__
    //Needs to stop after 2 intervals
    //Should Ipad be in the middle
    //Changle (High) fr requirement. Currently set to 20 in this sequence
    //sequence3();

    //__Sequence_4__
    //Needs to stop after 4 intervals
    //sequence4.init();
    //sequence4.seq();

    //--To Do--//
    //Sequence controller
    //timers to record data on all sequences.
    //export data to excel sheet
    //total-time-entry box on menu
    //Connect first time entry box
    //switch sides should be an integer (1 or 2)
    //Clean up sequence 1
    //Fire a "Complete" gui at the end of each sequence.
    //--------------//
    */
});
</script>
</html>
