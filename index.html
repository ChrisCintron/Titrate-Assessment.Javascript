<!DOCTYPE html>


<html>
<head>
    <title>Titrate Assessment</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="stylesheet.css" type="text/css">
</head>
<body>
    <div id="console1">
        <img src="images/ipad_Gideon.gif" class="myipad" alt="ipad">
        <div id="score1" class="score" >&bull;</div>

    </div>
    <div id="console2">
        <img src="images/book_Gideon.gif" class="mybook" alt="book">
        <div id="score2" class="score" >&bull;</div>
    </div>
</body>
<script>
$(document).ready(function(){

    //--Titrate Assessment--//
    //4 sequences total, with sequence #2 only playing the first day
    //-----------------------//
    //--To Do--//
    //timers to record data on all sequences.
    //export data to excel sheet
    //total-time-entry box on menu

    //////////

    var new_data = localStorage.getItem('Entry_Data');
    new_data = JSON.parse(new_data);
    var fr_ratio = new_data['key1'];
    var blackout_time = new_data['key2'];
    var switch_sides = new_data['key3'];
    var first_time = new_data['key4'];
    //var side = $('#console1').css("float");

    var general_helper =
    {
        what_sequence: 0, //Keeps track of sequence information
        Trial_number: 0,


        bundle_1_start: function(){
            console1.initialize();
            console1.update_gui_score();
            console_helper.show_everything();
        },

        reset_to_base: function() {
            general_helper.bundle_1_start();
            general_helper.side_switcher();
        },

        normal_side_puter: function() {
            $('#console1').css("float", "left");
            $('#console2').css("float", "right");
        },

        side_switcher: function() {
            var side = $('#console1').css("float");
            console.log('Side= ' + side);

            if (side == 'left') {
                $('#console1').css("float", "right");
                $('#console2').css("float", "left");
                console.log("I switched sides");

            } else if (side == 'right') {
                general_helper.normal_side_puter();
            } else {
                    console.log("Side switcher broke");
            };
        },
        reset: function() {
            console1.initialize();
            console_helper.show_everything();
        },
    };

    var console1 = {
        score: 0,
        initialize: function(){ //resets console1's score
                    console1.score = fr_ratio;

        },
        touch: function(){ //takes away a point from score
            console1.score -= 1;

        },
        update_gui_score: function(){ //Uses console1's score to update_gui_score visuals
                var str = Array(Number(console1.score)+ 1).join("&bull;"); //concatenates the large dots into Array
                $('#score1').html(str); //writes in the new html


        },

        score_one: function(){
                    console1.score = 1;
                    var str = Array(2).join("&bull;"); //Gives score one dot
                    $('#score1').html(str); //writes in the new html
        },
    };

    var console_helper = {

        console1_shower: function(){
                $('#console1').fadeIn();
                $('#score1').fadeIn();
        },
        hide_everything: function() {
                    $('#console1').fadeOut();
                    $('#score1').fadeOut();
                    $('#console2').fadeOut();
                    $('#score1').fadeOut();
                    },
        show_everything: function(){
            $('#console1').fadeIn();
            $('#score1').fadeIn();
            $('#console2').fadeIn();
            $('#score2').fadeIn();
        },
        checker: function(){
                if (console1.score < 1) {
                    console_helper.hide_everything();
                    timer.wait(general_helper.side_switcher);
                    timer.wait(console1.initialize);
                    timer.wait(console1.update_gui_score);
                    timer.wait(console_helper.show_everything);
                    general_helper.Trial_number += 1;

                } else {
                    console.log('Console1 is at: ' + console1.score);
                };

        },
        check_score: function(func){
                console.log("Score is: "+ console1.score);

                if (console1.score < 1) {
                    func();
                } else {
                };
        },
    };

    var timer = {
        //tracker: 0,
        records: [], //tracks individual session records
        start: function(){ performance.now();},
        stop: function(){performance.now();},
        log: function(){
            timer.records[timer.tracker] = (timer.stop-timer.start)*1000;
            timer.tracker += 1;
                        },
        wait: function(func){
            setTimeout(func, blackout_time*1000);

        },


    };

    //Sequence #1

    var sequence1 = function() {
        general_info.what_sequence = 1;
        //var blackout_time = blackout;
        //hide both consoles
        $('#console1').fadeOut();
        $('#console2').fadeOut();


        if (switch_sides == '1') {
            $('#console1').fadeIn();

            $('#console1').click(function() {
                $('#score1').fadeOut();

                setTimeout(function(){ $('#console1').fadeOut(); }, 500);
                setTimeout(function(){ $('#console2').fadeIn(); }, blackout_time * 1000);
                //$('#score1').show();

                $('#console2').click(function() {
                    $('#score2').hide();
                    setTimeout(function(){ $('#console2').fadeOut(); }, 500);
                    setTimeout(function(){ $('#console1').fadeIn(); }, blackout_time * 1000);
                    setTimeout(function(){ $('#console2').fadeIn(); }, blackout_time * 1000);
                    $('#score1').show();
                    $('#score2').show();
                });
            });
        }   else if (switch_sides == '2') {
            $('#console2').show();
            $('#console2').click(function() {
                setTimeout(function(){ $('#console2').fadeOut(); }, 500);
                setTimeout(function(){ $('#console1').fadeIn(); }, blackout_time * 1000);

                $('#console1').click(function() {
                    setTimeout(function(){ $('#console1').fadeOut(); }, 500);
                    setTimeout(function(){ $('#console2').fadeIn(); }, blackout_time * 1000);
                    setTimeout(function(){ $('#console1').fadeIn(); }, blackout_time * 1000);
                });
            });
        } else {
            console.log("Error in Sequence1");
        };
    };

    //Sequence #2
    function sequence2(){
        $('#console1').click(function(){
            console1.touch(); //subtracks 1 from score
            console1.update_gui_score(); //updates the gui based off of current score
            console_helper.checker(); //

        });
        $('#console2').click(function(){
            $('#score2').fadeOut();
            setTimeout(console_helper.hide_everything, 700);
            timer.wait(general_helper.reset_to_base);

        });
    };

    general_helper.bundle_1_start();

    // __SEQUENCE 3 DONE___ //
    var seq3_events = {
        number_of_trials: 2, //(1) low effort and another high effort
        number_of_trials_completed: 1,
        checker: function(){

            if ((seq3_events.number_of_trials_completed >= seq3_events.number_of_trials) && (console1.score < 1)) {
                console_helper.hide_everything();

                timer.wait(general_helper.bundle_1_start);
                timer.wait(general_helper.normal_side_puter);
                console.log("1");
            } else if (console1.score < 1) {
                    console.log("notc= " + seq3_events.number_of_trials_completed);
                    seq3_events.number_of_trials_completed += 1;
                    console_helper.hide_everything();
                    timer.wait(console_helper.console1_shower);
                    console1.score = 20; // ---------------- Hook entry box onto this
                    console1.update_gui_score();
                    console.log('2');
            } else{
                console.log("almost");

            };
        },
    };
    //Sequence #3 This only happens on first day
    function sequence3(){
        //init//
            console_helper.hide_everything();
            $('#console1').fadeIn();
            console1.score_one();
            $("#score1").fadeIn();
        ////

            $('#console1').click(function(){
                console1.touch();
                console1.update_gui_score();
                seq3_events.checker();
            });
    };

    //sequence3();




    //Sequence #4
    var sequence4 = {
        x:4,
        init: function() {
            if (switch_sides == '2') {
                general_helper.side_switcher();
            } else {

            };
            console1.initialize();
            console1.update_gui_score();

        },
        seq: function() {


        $('#console1').click(function(){
            console1.touch(); //subtracks 1 from score
            console1.update_gui_score(); //updates the gui based off of current score
            console_helper.checker(); //
            });
            $('#console2').click(function(){
                $('#score2').fadeOut();
                setTimeout(console_helper.hide_everything, 700);
                timer.wait(general_helper.reset_to_base);

            });
        },

    };

    sequence4.init()
    sequence4.seq();





});

</script>
</html>
